# media containers
name: media
services:

  jellyfin:
    image: ghcr.io/jellyfin/jellyfin:latest
    init: true
    restart: always
    networks:
      - media
    env_file:
      - ../default.env
    group_add:
      - 44
      - 123
    devices:
      - /dev/dri
    volumes:
      - /tmp/jellyfin:/transcodes
      - /tank/containers/jellyfin:/config
      - /tank/containers/jellyfin-cache:/cache
      - /tank/cloud/video:/media/video
      - /tank/cloud/music:/media/music
      - /tank/cloud/books:/media/books
      - /tank/cloud/comics:/media/comics
    expose:
      - 8096
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.jellyfin.loadbalancer.server.port=8096"
      - "traefik.http.routers.jellyfin.middlewares=secure@file"

  seerr:
    image: ghcr.io/seerr-team/seerr:latest
    init: true
    restart: always
    networks:
      - media
    env_file:
      - ../default.env
    volumes:
      - /tank/containers/seerr:/app/config
    expose:
      - 5055
    depends_on:
      - jellyfin
    healthcheck:
      test: wget --no-verbose --tries=1 --spider http://localhost:5055/api/v1/status || exit 1
      start_period: 20s
      timeout: 3s
      interval: 15s
      retries: 3
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.seerr.loadbalancer.server.port=5055"
      - "traefik.http.routers.seerr.middlewares=secure@file"

  gluetun:
    image: ghcr.io/qdm12/gluetun:v3
    init: true
    restart: always
    networks:
      - media
    cap_add:
      - NET_ADMIN
    env_file:
      - gluetun.env
    expose:
      - 8080
    ports:
      - 6881:6881/tcp
      - 6881:6881/udp
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.qbittorrent.loadbalancer.server.port=8080"
      - "traefik.http.routers.qbittorrent.middlewares=private@file"
      - "traefik.http.routers.qbittorrent.rule=Host(`qbittorrent.viggy96.me`)"

  qbittorrent:
    image: lscr.io/linuxserver/qbittorrent:latest
    restart: always
    network_mode: service:gluetun
    env_file:
      - ../default.env
    environment:
      - UMASK=022
      - WEBUI_PORT=8080
    depends_on:
      - gluetun
    volumes:
      - /tank/containers/qbittorrent:/config
      - /tank/downloads:/downloads

  nzbget:
    image: lscr.io/linuxserver/nzbget:latest
    restart: always
    networks:
      - media
    env_file:
      - ../default.env
    environment:
      - UMASK=022
    volumes:
      - /tank/containers/nzbget:/config
      - /tank/downloads/nzbget:/downloads
    expose:
      - 6789
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.nzbget.loadbalancer.server.port=6789"
      - "traefik.http.routers.nzbget.middlewares=private@file"

  recyclarr:
    image: ghcr.io/recyclarr/recyclarr:latest
    init: true
    restart: always
    user: 33:33
    networks:
      - media
    env_file:
      - ../default.env
    volumes:
      - /tank/containers/recyclarr:/config

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    restart: always
    networks:
      - media
    env_file:
      - ../default.env
    volumes:
      - /tank/containers/prowlarr:/config
    expose:
      - 9696
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.prowlarr.loadbalancer.server.port=9696"
      - "traefik.http.routers.prowlarr.middlewares=private@file"

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    restart: always
    networks:
      - media
    env_file:
      - ../default.env
    volumes:
      - /tank/containers/sonarr:/config
      - /tank/cloud/video/tv:/tv
      - /tank/downloads:/downloads
    expose:
      - 8989
    depends_on:
      - qbittorrent
      - nzbget
      - prowlarr
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.sonarr.loadbalancer.server.port=8989"
      - "traefik.http.routers.sonarr.middlewares=private@file"

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    restart: always
    networks:
      - media
    env_file:
      - ../default.env
    volumes:
      - /tank/containers/radarr:/config
      - /tank/cloud/video/movies:/movies
      - /tank/downloads:/downloads
    expose:
      - 7878
    depends_on:
      - qbittorrent
      - nzbget
      - prowlarr
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.radarr.loadbalancer.server.port=7878"
      - "traefik.http.routers.radarr.middlewares=private@file"

  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    restart: always
    networks:
      - media
    env_file:
      - ../default.env
    volumes:
      - /tank/containers/bazarr:/config
      - /tank/cloud/video/tv:/tv
      - /tank/cloud/video/movies:/movies
    expose:
      - 6767
    depends_on:
      - sonarr
      - radarr
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.bazarr.loadbalancer.server.port=6767"
      - "traefik.http.routers.bazarr.middlewares=private@file"

  lidarr:
    image: lscr.io/linuxserver/lidarr:latest
    restart: always
    networks:
      - media
    env_file:
      - ../default.env
    volumes:
      - /tank/containers/lidarr:/config
      - /tank/cloud/music:/music
      - /tank/downloads:/downloads
    expose:
      - 8686
    depends_on:
      - qbittorrent
      - nzbget
      - prowlarr
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.lidarr.loadbalancer.server.port=8686"
      - "traefik.http.routers.lidarr.middlewares=private@file"

  kapowarr:
    image: mrcas/kapowarr:latest
    restart: always
    networks:
      - media
    env_file:
      - ../default.env
    volumes:
      - /tank/containers/kapowarr:/app/db
      - /tank/cloud/comics:/comics
      - /tank/downloads:/downloads
    expose:
      - 5656
    depends_on:
      - qbittorrent
      - nzbget
      - prowlarr
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.kapowarr.loadbalancer.server.port=5656"
      - "traefik.http.routers.kapowarr.middlewares=private@file"

  komga:
     image: ghcr.io/gotson/komga:latest
     restart: always
     user: 33:33
     networks:
       - media
     env_file:
       - ../default.env
     volumes:
       - /tank/containers/komga:/config
       - /tank/cloud/comics:/comics
       - /tank/cloud/books:/books
       - /tank/downloads:/downloads
     expose:
       - 25600
     labels:
       - "traefik.enable=true"
       - "traefik.http.services.komga.loadbalancer.server.port=25600"
       - "traefik.http.routers.komga.middlewares=secure@file" 

